/**
 * Yii form widget.
 *
 * This is the JavaScript widget used by the yii\widgets\ActiveForm widget.
 *
 * @link http://www.yiiframework.com/
 * @copyright Copyright (c) 2008 Yii Software LLC
 * @license http://www.yiiframework.com/license/
 * @author Qiang Xue <qiang.xue@gmail.com>
 * @since 2.0
 */
!function(t){t.fn.yiiActiveForm=function(i){return v[i]?v[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?(t.error("Method "+i+" does not exist on jQuery.yiiActiveForm"),!1):v.init.apply(this,arguments)};var i,e="beforeValidate",a="afterValidate",s="beforeValidateAttribute",n="afterValidateAttribute",r="beforeSubmit",o="ajaxBeforeSend",u="ajaxComplete",l={encodeErrorSummary:!0,errorSummary:".error-summary",validateOnSubmit:!0,errorCssClass:"has-error",successCssClass:"has-success",validatingCssClass:"validating",ajaxParam:"ajax",ajaxDataType:"json",validationUrl:void 0,scrollToError:!0},d={id:void 0,name:void 0,container:void 0,input:void 0,error:".help-block",encodeError:!0,validateOnChange:!0,validateOnBlur:!0,validateOnType:!1,validationDelay:500,enableAjaxValidation:!1,validate:void 0,status:0,cancelled:!1,value:void 0},c=function(t){i&&(i.resolve(),i=void 0,t.removeData("yiiSubmitFinalizePromise"))},v={init:function(i,e){return this.each((function(){var a=t(this);if(!a.data("yiiActiveForm")){var s=t.extend({},l,e||{});void 0===s.validationUrl&&(s.validationUrl=a.attr("action")),t.each(i,(function(e){i[e]=t.extend({value:A(a,this)},d,this),h(a,i[e])})),a.data("yiiActiveForm",{settings:s,attributes:i,submitting:!1,validated:!1}),a.bind("reset.yiiActiveForm",v.resetForm),s.validateOnSubmit&&(a.on("mouseup.yiiActiveForm keyup.yiiActiveForm",":submit",(function(){a.data("yiiActiveForm").submitObject=t(this)})),a.on("submit.yiiActiveForm",v.submitForm))}}))},add:function(i){var e=t(this);i=t.extend({value:A(e,i)},d,i),e.data("yiiActiveForm").attributes.push(i),h(e,i)},remove:function(i){var e=t(this),a=e.data("yiiActiveForm").attributes,s=-1,n=void 0;return t.each(a,(function(t){if(a[t].id==i)return s=t,n=a[t],!1})),s>=0&&(a.splice(s,1),m(e,n)),n},validateAttribute:function(i){var e=v.find.call(this,i);null!=e&&f(t(this),e,!0)},find:function(i){var e=t(this).data("yiiActiveForm").attributes,a=void 0;return t.each(e,(function(t){if(e[t].id==i)return a=e[t],!1})),a},destroy:function(){return this.each((function(){t(this).unbind(".yiiActiveForm"),t(this).removeData("yiiActiveForm")}))},data:function(){return this.data("yiiActiveForm")},validate:function(){var i=t(this),a=i.data("yiiActiveForm"),n=!1,r={},l=g(),d=a.submitting;if(d){var v=t.Event(e);if(i.trigger(v,[r,l]),!1===v.result)return a.submitting=!1,void c(i)}t.each(a.attributes,(function(){if(this.cancelled=!1,a.submitting||2===this.status||3===this.status){var e=r[this.id];void 0===e&&(e=[],r[this.id]=e);var o=t.Event(s);i.trigger(o,[this,e,l]),!1!==o.result?(this.validate&&this.validate(this,A(i,this),e,l,i),this.enableAjaxValidation&&(n=!0)):this.cancelled=!0}})),t.when.apply(this,l).always((function(){for(var e in r)0===r[e].length&&delete r[e];if(n){var s=a.submitObject,l="&"+a.settings.ajaxParam+"="+i.attr("id");s&&s.length&&s.attr("name")&&(l+="&"+s.attr("name")+"="+s.attr("value")),t.ajax({url:a.settings.validationUrl,type:i.attr("method"),data:i.serialize()+l,dataType:a.settings.ajaxDataType,complete:function(t,e){i.trigger(u,[t,e])},beforeSend:function(t,e){i.trigger(o,[t,e])},success:function(e){null!==e&&"object"==typeof e?(t.each(a.attributes,(function(){this.enableAjaxValidation&&!this.cancelled||delete e[this.id]})),y(i,t.extend(r,e),d)):y(i,r,d)},error:function(){a.submitting=!1,c(i)}})}else a.submitting?setTimeout((function(){y(i,r,d)}),200):y(i,r,d)}))},submitForm:function(){var e=t(this),a=e.data("yiiActiveForm");if(a.validated){a.submitting=!1;var s=t.Event(r);return e.trigger(s),!1!==s.result||(a.validated=!1,c(e),!1)}return function(e){i=t.Deferred(),e.data("yiiSubmitFinalizePromise",i.promise())}(e),void 0!==a.settings.timer&&clearTimeout(a.settings.timer),a.submitting=!0,v.validate.call(e),!1},resetForm:function(){var i=t(this),e=i.data("yiiActiveForm");setTimeout((function(){t.each(e.attributes,(function(){this.value=A(i,this),this.status=0;var t=i.find(this.container);t.removeClass(e.settings.validatingCssClass+" "+e.settings.errorCssClass+" "+e.settings.successCssClass),t.find(this.error).html("")})),i.find(e.settings.errorSummary).hide().find("ul").html("")}),1)},updateMessages:function(i,e){var a=t(this),s=a.data("yiiActiveForm");t.each(s.attributes,(function(){b(a,this,i)})),e&&p(a,i)},updateAttribute:function(i,e){var a=v.find.call(this,i);if(null!=a){var s={};s[i]=e,b(t(this),a,s)}}},h=function(i,e){var a=C(i,e);e.validateOnChange&&a.on("change.yiiActiveForm",(function(){f(i,e,!1)})),e.validateOnBlur&&a.on("blur.yiiActiveForm",(function(){0!=e.status&&1!=e.status||f(i,e,!e.status)})),e.validateOnType&&a.on("keyup.yiiActiveForm",(function(a){-1===t.inArray(a.which,[16,17,18,37,38,39,40])&&e.value!==A(i,e)&&f(i,e,!1,e.validationDelay)}))},m=function(t,i){C(t,i).off(".yiiActiveForm")},f=function(i,e,a,s){var n=i.data("yiiActiveForm");a&&(e.status=2),t.each(n.attributes,(function(){this.value!==A(i,this)&&(this.status=2,a=!0)})),a&&(void 0!==n.settings.timer&&clearTimeout(n.settings.timer),n.settings.timer=setTimeout((function(){n.submitting||i.is(":hidden")||(t.each(n.attributes,(function(){2===this.status&&(this.status=3,i.find(this.container).addClass(n.settings.validatingCssClass))})),v.validate.call(i))}),s||200))},g=function(){var i=[];return i.add=function(i){this.push(new t.Deferred(i))},i},y=function(i,e,s){var n=i.data("yiiActiveForm");if(s){var r=[];if(t.each(n.attributes,(function(){!this.cancelled&&b(i,this,e)&&r.push(this)})),i.trigger(a,[e,r]),p(i,e),r.length){if(n.settings.scrollToError){var o=i.find(t.map(r,(function(t){return t.input})).join(",")).first().closest(":visible").offset().top,u=t(window).scrollTop();(o<u||o>u+t(window).height())&&t(window).scrollTop(o)}n.submitting=!1}else{n.validated=!0;var l=n.submitObject||i.find(":submit:first");if(l.length&&"submit"==l.attr("type")&&l.attr("name")){var d=t('input[type="hidden"][name="'+l.attr("name")+'"]',i);d.length?d.attr("value",l.attr("value")):t("<input>").attr({type:"hidden",name:l.attr("name"),value:l.attr("value")}).appendTo(i)}i.submit()}}else t.each(n.attributes,(function(){this.cancelled||2!==this.status&&3!==this.status||b(i,this,e)}));c(i)},b=function(i,e,a){var s=i.data("yiiActiveForm"),r=C(i,e),o=!1;if(t.isArray(a[e.id])||(a[e.id]=[]),i.trigger(n,[e,a[e.id]]),e.status=1,r.length){o=a[e.id].length>0;var u=i.find(e.container),l=u.find(e.error);o?(e.encodeError?l.text(a[e.id][0]):l.html(a[e.id][0]),u.removeClass(s.settings.validatingCssClass+" "+s.settings.successCssClass).addClass(s.settings.errorCssClass)):(l.empty(),u.removeClass(s.settings.validatingCssClass+" "+s.settings.errorCssClass+" ").addClass(s.settings.successCssClass)),e.value=A(i,e)}return o},p=function(i,e){var a=i.data("yiiActiveForm"),s=i.find(a.settings.errorSummary),n=s.find("ul").empty();s.length&&e&&(t.each(a.attributes,(function(){if(t.isArray(e[this.id])&&e[this.id].length){var i=t("<li/>");a.settings.encodeErrorSummary?i.text(e[this.id][0]):i.html(e[this.id][0]),n.append(i)}})),s.toggle(n.find("li").length>0))},A=function(t,i){var e=C(t,i),a=e.attr("type");if("checkbox"===a||"radio"===a){var s=e.filter(":checked");return s.length||(s=t.find('input[type=hidden][name="'+e.attr("name")+'"]')),s.val()}return e.val()},C=function(t,i){var e=t.find(i.input);return e.length&&"div"===e[0].tagName.toLowerCase()?e.find("input"):e}}(window.jQuery);